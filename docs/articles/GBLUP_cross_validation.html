<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GBLUP and cross validation • qgg</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="GBLUP and cross validation">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">qgg</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/qgg.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Small_data_set_tutorial.html">Small data set tutorial</a>
    </li>
    <li>
      <a href="../articles/Prepare_Phenotype_Data_Starvation.html">Prepare Phenotype and Covariate Data</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="../news/index.html">Changelog</a>
</li>
<li>
  <a href="https://github.com/psoerensen/qgg">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>GBLUP and cross validation</h1>
                        <h4 class="author">Izel Fourie Sørensen</h4>
            
            <h4 class="date">02 November, 2018</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/psoerensen/qgg/blob/master/vignettes/GBLUP_cross_validation.Rmd"><code>vignettes/GBLUP_cross_validation.Rmd</code></a></small>
      <div class="hidden name"><code>GBLUP_cross_validation.Rmd</code></div>

    </div>

    
    
<p><br></p>
<p>Here we show how to perform a GBLUP analysis and cross validation using the greml function in the qgg package. This involves estimating variance components with restricted maximum likelihood estimation (REML) in the training set and prediction using genomic best linear unbiased prediction (GBLUP) in the validation set. This will be illustrated on the “starvation resistance” phenotype available from the <a href="http://dgrp2.gnets.ncsu.edu/">Drosophila genetic reference panel</a> (DGRP).</p>
<p>To perform a GBLUP analysis the following input data is essential.</p>
<ol style="list-style-type: decimal">
<li>
<span class="math inline">\(y\)</span>: vector of phenotype</li>
<li>
<span class="math inline">\(X\)</span>: design matrix for covariables</li>
<li>
<span class="math inline">\(W\)</span>: centered and scaled genotype matrix</li>
<li>
<span class="math inline">\(G\)</span>: genomic relationship matrix</li>
</ol>
<p>This script includes the following steps for performing a GBLUP analysis and cross validation: 1) load and prepare data for GBLUP analysis, 2) restricted maximum likelihood (REML) analyses for estimating variance components, and 3) REML analyses and cross validation.</p>
<p><br></p>
<div id="load-and-prepare-data-for-gblup-analysis" class="section level5">
<h5 class="hasAnchor">
<a href="#load-and-prepare-data-for-gblup-analysis" class="anchor"></a><strong>1. Load and prepare data for GBLUP analysis</strong>
</h5>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#library(devtools)</span>
<span class="co">#install_github("psoerensen/qgg")</span>
<span class="kw">library</span>(qgg)</code></pre></div>
<pre><code>## Warning: package 'regress' was built under R version 3.5.1</code></pre>
<pre><code>## Warning: package 'data.table' was built under R version 3.5.1</code></pre>
<p><strong>Load phenotype and co-variable data</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="dt">file =</span> <span class="st">"./phenotypes/starv_inv_wo.Rdata"</span>)
<span class="kw">dim</span>(starv)</code></pre></div>
<pre><code>## [1] 406  20</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(starv)</code></pre></div>
<pre><code>##     L sex        y  In2Lt In2RNS In2RY1 In2RY2 In2RY3 In2RY4 In2RY5 In2RY6
## 1 100   M 49.28000 INV/ST     ST     ST     ST     ST     ST     ST     ST
## 2 101   M 47.20000 INV/ST     ST     ST     ST     ST     ST     ST     ST
## 3 105   M 51.04000     ST     ST     ST     ST     ST     ST     ST     ST
## 4 109   M 44.96000 INV/ST     ST     ST     ST     ST     ST     ST     ST
## 5 129   M 33.08475     ST     ST     ST     ST     ST     ST     ST     ST
## 6 136   M 63.04000     ST     ST     ST     ST     ST     ST     ST     ST
##   In2RY7  In3LP In3LM In3LY In3RP  In3RK In3RMo In3RC wo
## 1     ST     ST    ST    ST    ST    INV     ST    ST  y
## 2     ST     ST    ST    ST    ST     ST     ST    ST  n
## 3     ST     ST    ST    ST    ST    INV     ST    ST  n
## 4     ST     ST    ST    ST    ST     ST     ST    ST  n
## 5     ST     ST    ST    ST    ST     ST     ST    ST  n
## 6     ST INV/ST    ST    ST    ST INV/ST     ST    ST  y</code></pre>
<p>Create a vector of the starvation resistance phenotype, <span class="math inline">\(\mathbf{y}\)</span>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">data &lt;-<span class="st"> </span>starv
y &lt;-<span class="st"> </span>data<span class="op">$</span>y</code></pre></div>
<p>Prepare the design matrix <span class="math inline">\(\mathbf{X}\)</span> for the covariables. <code>fm</code> is the formula used for including relevant variables in the model in order to construct a design matrix.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fm &lt;-<span class="st"> </span>y <span class="op">~</span><span class="st">  </span>wo <span class="op">+</span>In2Lt <span class="op">+</span><span class="st"> </span>In2RNS <span class="op">+</span><span class="st"> </span>In3RP <span class="op">+</span><span class="st"> </span>In3RK <span class="op">+</span><span class="st"> </span>In3RMo
X &lt;-<span class="st"> </span><span class="kw">model.matrix</span>(fm, <span class="dt">data=</span>data)
<span class="kw">dim</span>(X)</code></pre></div>
<pre><code>## [1] 406  12</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">X[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>,]</code></pre></div>
<pre><code>##   (Intercept) woy In2LtINV/ST In2LtST In2RNSINV/ST In2RNSST In3RPINV/ST
## 1           1   1           1       0            0        1           0
## 2           1   0           1       0            0        1           0
## 3           1   0           0       1            0        1           0
## 4           1   0           1       0            0        1           0
## 5           1   0           0       1            0        1           0
##   In3RPST In3RKINV/ST In3RKST In3RMoINV/ST In3RMoST
## 1       1           0       0            0        1
## 2       1           0       1            0        1
## 3       1           0       0            0        1
## 4       1           0       1            0        1
## 5       1           0       1            0        1</code></pre>
<p><br></p>
<p><strong>Load centered and scaled genotype matrix</strong> <span class="math inline">\(\mathbf{W}\)</span></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="dt">file=</span> <span class="st">"./genotypes/dgrp2_W2.Rdata"</span>)
<span class="kw">dim</span>(W)</code></pre></div>
<pre><code>## [1]     205 1725755</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">W[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>,<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]</code></pre></div>
<pre><code>##       2L_5317    2L_5372    2L_5390    2L_5403    2L_5465
## 21 -0.2486289 -0.6646914  1.2122772 -0.4059216 -0.4007831
## 26 -0.2486289 -0.6646914 -0.8200699 -0.4059216 -0.4007831
## 28 -0.2486289 -0.6646914  1.2122772 -0.4059216 -0.4007831
## 31  4.0006648 -0.6646914 -0.8200699 -0.4059216 -0.4007831
## 32 -0.2486289 -0.6646914 -0.8200699 -0.4059216 -0.4007831</code></pre>
<p><br></p>
<p><strong>Compute <span class="math inline">\(G\)</span> from <span class="math inline">\(W\)</span></strong></p>
<p>The additive genomic relationship matrix <span class="math inline">\(\mathbf{G}\)</span> (VanRaden PM. 2008. J Dairy Sci. 91:4414-4423) is constructed using all genetic markers as follows: <span class="math inline">\(\mathbf{G=WW}'/m\)</span>, where <span class="math inline">\(\mathbf{W}\)</span> is the centered and scaled genotype matrix, and <span class="math inline">\(m\)</span> is the total number of markers.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">L &lt;-<span class="st"> </span>data<span class="op">$</span>L
G &lt;-<span class="st"> </span><span class="kw"><a href="../reference/grm.html">grm</a></span>(<span class="dt">W=</span>W)
G &lt;-<span class="st"> </span>G[L,L] <span class="co"># this ensures that row id's in G corresponds to row id's in data, there is male and female data for each line.</span></code></pre></div>
<p><br></p>
</div>
<div id="restricted-maximum-likelihood-reml-analyses" class="section level5">
<h5 class="hasAnchor">
<a href="#restricted-maximum-likelihood-reml-analyses" class="anchor"></a><strong>2. Restricted maximum likelihood (REML) analyses</strong>
</h5>
<p><strong>Behind the scenes of the greml function:</strong><br>
REML analyses are used for estimating the variance components, <span class="math inline">\(\sigma_{g}^2\)</span> and <span class="math inline">\(\sigma_{e}^2\)</span> for the random effects in the linear mixed model: <span class="math display">\[\mathbf{y = {X}b + {Z}g + e}\]</span></p>
<p>where <span class="math inline">\(\mathbf{y}\)</span> is the vector of phenotypic observations, <span class="math inline">\(\mathbf{X}\)</span> and <span class="math inline">\(\mathbf{Z}\)</span> are design matrices for the fixed and random effects, <span class="math inline">\(\mathbf{b}\)</span> is a vector of fixed effects, <span class="math inline">\(\mathbf{g}\)</span> is the vector of genomic values captured by all genetic markers, and <span class="math inline">\(\mathbf{e}\)</span> is the vector of residuals. The random genomic values and the residuals were assumed to be independent normally distributed values described as follows: <span class="math inline">\(\mathbf{g} \sim N(0,\mathbf{G}\sigma_g^2 )\)</span> and <span class="math inline">\(\mathbf{e} \sim N(0,\mathbf{I}\sigma_e^2)\)</span>. Thus, we assume that the observed phenotypes <span class="math inline">\(\mathbf{y} \sim N(\mathbf{Xb,V})\)</span> where <span class="math inline">\(\mathbf{V}=\mathbf{ZGZ}'\sigma_g^2+\mathbf{I}\sigma_e^2\)</span>.</p>
<p>Here we predict the genetic value based on the phenotype observed in the whole study population:</p>
<p><span class="math display">\[\mathbf{\hat{g}} = \hat\sigma_g^2\mathbf{GZ}'{\hat{\mathbf{V}}}^{-1}(\mathbf{y-X\hat{b}}) \]</span></p>
<p>The phenotype is predicted as:</p>
<p><span class="math display">\[\mathbf{\hat{y} = X\hat{b} + Z\hat{g}}\]</span></p>
<p>The <code>greml</code> function goes through a number of iterations before convergence (i.e., the change in parameters between consecutive rounds become smaller than a specified threshold, see “tol” argument in the greml help page). In this example each iteration returns values for the variance components <span class="math inline">\(\sigma_{g}^2\)</span> (third column) and <span class="math inline">\(\sigma_{e}^2\)</span> (fourth column).</p>
<p>The greml function returns a list structure that includes estimates of the fixed effects (<span class="math inline">\(\mathbf{b}\)</span>), random effects (<span class="math inline">\(\mathbf{g}\)</span>) and residual effects (<span class="math inline">\(\mathbf{e}\)</span>). Other values in the list are described on the greml help page.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fitG &lt;-<span class="st"> </span><span class="kw"><a href="../reference/greml.html">greml</a></span>(<span class="dt">y=</span>y, <span class="dt">X=</span>X, <span class="dt">GRM=</span><span class="kw">list</span>(<span class="dt">G=</span>G), <span class="dt">verbose =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## [1] "Iteration:" "1"          "Theta:"     "6.5"        "6.64"      
## [1] "Iteration:" "2"          "Theta:"     "12.2"       "13"        
## [1] "Iteration:" "3"          "Theta:"     "21.51"      "24.88"     
## [1] "Iteration:" "4"          "Theta:"     "33.69"      "45.66"     
## [1] "Iteration:" "5"          "Theta:"     "42.78"      "77.52"     
## [1] "Iteration:" "6"          "Theta:"     "40.09"      "115.14"    
## [1] "Iteration:" "7"          "Theta:"     "30.91"      "141.89"    
## [1] "Iteration:" "8"          "Theta:"     "27.73"      "149.24"    
## [1] "Iteration:" "9"          "Theta:"     "27.62"      "149.58"    
## [1] "Iteration:" "10"         "Theta:"     "27.62"      "149.58"    
## [1] "Iteration:" "11"         "Theta:"     "27.62"      "149.58"    
## [1] "Converged at Iteration:" "12"                     
## [3] "Theta:"                  "27.62"                  
## [5] "149.58"</code></pre>
<p><br></p>
</div>
<div id="reml-analyses-and-cross-validation" class="section level5">
<h5 class="hasAnchor">
<a href="#reml-analyses-and-cross-validation" class="anchor"></a><strong>3. REML analyses and cross validation</strong>
</h5>
<p>The genetic value is predicted based on the genomic relationship between the training and validation population:</p>
<p><span class="math display">\[ \mathbf{\hat{g}}^v = \hat\sigma_g^2\mathbf{G}^{vt}\mathbf{Z'{\hat{V}_t}}^{-1}(\mathbf{y}_t-\mathbf{X}_t\hat{\mathbf{b}_t}) \]</span> Where the genomic relationship matrix <span class="math display">\[ \mathbf{G} =
\left(\begin{array}{cc} \mathbf{G}^{vv} &amp; \mathbf{G}^{vt}\\
\mathbf{G}^{vt} &amp; \mathbf{G}^{tt} \end{array}
\right)\]</span></p>
<p>is partitioned according to relationships between the individuals in the training (<span class="math inline">\(t\)</span>) data <span class="math inline">\(\mathbf{G}^{tt}\)</span>, between the individuals in the validation (<span class="math inline">\(v\)</span>) data <span class="math inline">\(\mathbf{G}^{vv}\)</span> and between the individuals in the training and validation data <span class="math inline">\(\mathbf{G}^{vt}\)</span>. Thus the total genomic predisposition is predicted using the estimated variance components (<span class="math inline">\(\sigma_g^2\)</span> and <span class="math inline">\(\sigma_e^2\)</span>) in the training data. The right-most term, <span class="math inline">\((\mathbf{y}_t-\mathbf{X}_t\hat{\mathbf{b}_t})\)</span>, constitutes the phenotypes corrected for fixed effects for the individuals in the training data. The inverse term <span class="math inline">\(\hat{\mathbf{V}}_t^{-1}\)</span> is essentially the variance-covariance structure for the corrected phenotypes. These two terms multiplied together are the standardized and corrected phenotypes for the individuals in the training data, which are projected onto the total genetic covariance structure between the training and the validation data.</p>
<p>Variance components for the phenotype observed in the <em>training set</em> are estimated. Based on the estimated variance components, the phenotype in the <em>validation set</em> is predicted as: <span class="math display">\[\hat{\mathbf{y}_v} = \mathbf{X}_v\hat{\mathbf{b}_t} + \mathbf{Z\hat{g}}_v + \mathbf{e}\]</span></p>
<p>50 validation sets are created by randomly sampling 30 values from 1 - 406 (the length of <span class="math inline">\(\mathbf{y}\)</span>), and repeating this sampling 50 times. The validation sets are saved in the <code>validate</code> matrix. This matrix specifies the rows of the data used in the GREML analyses.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">n &lt;-<span class="st"> </span><span class="kw">length</span>(y)
validate &lt;-<span class="st"> </span><span class="kw">replicate</span>(<span class="dv">50</span>, <span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span>n, <span class="dv">30</span>))
cvG &lt;-<span class="st"> </span><span class="kw"><a href="../reference/greml.html">greml</a></span>(<span class="dt">y =</span> y, <span class="dt">X =</span> X, <span class="dt">GRM =</span> <span class="kw">list</span>(<span class="dt">G=</span>G), <span class="dt">validate =</span> validate)
<span class="kw">str</span>(cvG)</code></pre></div>
<pre><code>## List of 4
##  $ accuracy:'data.frame':    50 obs. of  7 variables:
##   ..$ Corr     : num [1:50] 0.294 0.304 0.16 0.598 0.048 0.176 0.149 0.205 0.393 -0.066 ...
##   ..$ R2       : num [1:50] 0.086 0.092 0.026 0.357 0.002 0.031 0.022 0.042 0.154 0.004 ...
##   ..$ Nagel R2 : num [1:50] NA NA NA NA NA NA NA NA NA NA ...
##   ..$ AUC      : num [1:50] NA NA NA NA NA NA NA NA NA NA ...
##   ..$ intercept: num [1:50] 49.1 49.4 50.6 47.5 53.5 ...
##   ..$ slope    : num [1:50] 0.082 0.091 0.024 0.142 0.019 0.04 0.042 0.051 0.113 -0.016 ...
##   ..$ MSPE     : num [1:50] 148 142 173 164 170 ...
##  $ theta   :'data.frame':    50 obs. of  2 variables:
##   ..$ G: num [1:50] 24.5 29.1 24.7 26.7 36.1 ...
##   ..$ E: num [1:50] 154 151 152 151 144 ...
##  $ yobs    : num [1:1500] 52.7 38.7 50 43.7 91.2 ...
##  $ ypred   : num [1:1500] 53.7 48.3 49.7 51 58.8 ...</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cvG<span class="op">$</span>accuracy[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>,]</code></pre></div>
<pre><code>##    Corr    R2 Nagel R2 AUC intercept slope    MSPE
## 1 0.294 0.086       NA  NA    49.057 0.082 148.003
## 2 0.304 0.092       NA  NA    49.449 0.091 141.987
## 3 0.160 0.026       NA  NA    50.588 0.024 173.350
## 4 0.598 0.357       NA  NA    47.495 0.142 164.279
## 5 0.048 0.002       NA  NA    53.529 0.019 170.110</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cvG<span class="op">$</span>theta[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>,]</code></pre></div>
<pre><code>##        G       E
## 1 24.549 154.421
## 2 29.053 151.082
## 3 24.712 152.325
## 4 26.678 151.384
## 5 36.097 144.242</code></pre>
<p><br></p>
<p><strong>Output of the GREML cross validation analysis</strong></p>
<p>The output includes statistics that quantify the model’s predictive ability as assessed by regressing the observed phenotype against the predicted phenotype for the validation data set: <span class="math inline">\(y = intercept + \hat{y} slope + e\)</span></p>
<p>Explanation of the values in <code>cvG$accuracy</code>:</p>
<table style="width:100%;" class="table">
<colgroup>
<col width="10%">
<col width="10%">
<col width="79%">
</colgroup>
<thead><tr class="header">
<th align="left">Value</th>
<th align="left"></th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Corr</td>
<td align="left"></td>
<td>Correlation between the predicted and observed phenotypic value. Averaging the list of 50 correlations yields the predictive ability</td>
</tr>
<tr class="even">
<td align="left">R2</td>
<td align="left"></td>
<td>
<span class="math inline">\(R^2\)</span>, proportion of the total variance that is explained by the GBLUP model</td>
</tr>
<tr class="odd">
<td align="left">Nagel R2</td>
<td align="left"></td>
<td>Nagelkerke’s <span class="math inline">\(R\)</span>
</td>
</tr>
<tr class="even">
<td align="left">AUC</td>
<td align="left"></td>
<td>Area Under the ROC Curve</td>
</tr>
<tr class="odd">
<td align="left">intercept</td>
<td align="left"></td>
<td>The y-axis intercept for the regression of <span class="math inline">\(\mathbf{y}\)</span> unto <span class="math inline">\(\hat{\mathbf{y}}\)</span>
</td>
</tr>
<tr class="even">
<td align="left">slope</td>
<td align="left"></td>
<td>Slope for the regression of <span class="math inline">\(\mathbf{y}\)</span> unto <span class="math inline">\(\hat{\mathbf{y}}\)</span>
</td>
</tr>
<tr class="odd">
<td align="left">MSPE</td>
<td align="left"></td>
<td>mean squared prediction error = <span class="math inline">\(\frac{1}{n_v}\sum_{i=1}^{n_v}({\mathbf{y}_i - \hat{\mathbf{y}_i})^2}\)</span>, <span class="math inline">\(n_v\)</span> = number of observations in validation set</td>
</tr>
</tbody>
</table>
<p>Explanation of the values in <code>cvG$theta</code>:</p>
<table class="table">
<thead><tr class="header">
<th align="left">Value</th>
<th align="left"></th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">G</td>
<td align="left"></td>
<td>Estimated variance component, <span class="math inline">\(\hat\sigma_{g}^2\)</span>
</td>
</tr>
<tr class="even">
<td align="left">E</td>
<td align="left"></td>
<td>Estimated variance component, <span class="math inline">\(\hat\sigma_{e}^2\)</span>
</td>
</tr>
</tbody>
</table>
<p><br></p>
<p><strong>Prepare data frame of results</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">accuMeans &lt;-<span class="st"> </span><span class="kw">colMeans</span>(cvG<span class="op">$</span>accuracy)
thetaMeans &lt;-<span class="st"> </span><span class="kw">colMeans</span>(cvG<span class="op">$</span>theta)

accuSEM &lt;-<span class="st"> </span><span class="kw">apply</span>(cvG<span class="op">$</span>accuracy, <span class="dv">2</span>, <span class="cf">function</span>(x){<span class="kw">sd</span>(x)<span class="op">/</span><span class="kw">sqrt</span>(<span class="dv">50</span>)})
thetaSEM &lt;-<span class="st"> </span><span class="kw">apply</span>(cvG<span class="op">$</span>theta, <span class="dv">2</span>, <span class="cf">function</span>(x){<span class="kw">sd</span>(x)<span class="op">/</span><span class="kw">sqrt</span>(<span class="dv">50</span>)})

stat &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"mean"</span>,<span class="st">"sem"</span>)
results1 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(stat, <span class="kw">rbind</span>(accuMeans, accuSEM))
results2 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(stat, <span class="kw">rbind</span>(thetaMeans, thetaSEM))
results &lt;-<span class="st"> </span><span class="kw">cbind</span>(results1,results2)
results</code></pre></div>
<pre><code>##           stat       Corr         R2 Nagel.R2 AUC intercept       slope
## accuMeans mean 0.19306000 0.07146000       NA  NA 50.403740 0.054440000
## accuSEM    sem 0.02645399 0.01045399       NA  NA  0.436142 0.008085722
##                 MSPE stat          G           E
## accuMeans 171.455500 mean 27.3324200 150.3625000
## accuSEM     6.491496  sem  0.6364689   0.6459845</code></pre>
<p><strong>Heritability (<span class="math inline">\(\hat{h^2}\)</span>)</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">h2fm &lt;-<span class="st"> </span>cvG<span class="op">$</span>theta<span class="op">$</span>G<span class="op">/</span>(cvG<span class="op">$</span>theta<span class="op">$</span>G<span class="op">+</span>cvG<span class="op">$</span>theta<span class="op">$</span>E)
<span class="kw">boxplot</span>(h2fm, <span class="dt">main =</span> <span class="st">"Genomic Heritability"</span>)</code></pre></div>
<p><img src="GBLUP_cross_validation_files/figure-html/unnamed-chunk-10-1.png" width="288"></p>
<p><strong>Histogram of genetic values</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">hist</span>(fitG<span class="op">$</span>g, <span class="dt">xlab =</span> <span class="st">"genetic value"</span>, <span class="dt">main =</span> <span class="st">"REML"</span>)</code></pre></div>
<p><img src="GBLUP_cross_validation_files/figure-html/unnamed-chunk-11-1.png" width="336"></p>
<p><strong>Histogram of phenotype</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">hist</span>(y, <span class="dt">xlab =</span> <span class="st">"hours"</span>, <span class="dt">main =</span> <span class="st">"Starvation Resistance"</span>)</code></pre></div>
<p><img src="GBLUP_cross_validation_files/figure-html/unnamed-chunk-12-1.png" width="336"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Peter Soerensen, Palle Duun Rohde, Izel Fourie Soerensen.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
